<!doctype html>
<html lang="ja">
<head>
  <script src="../../js/analytics.js"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF参照モード | 情報技術検定</title>
  <link rel="stylesheet" href="../../assets/css/digital.css" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
<script id="dg-topbar-loader">
(function () {
  const firstSeg = (location.pathname.split("/")[1] || "").trim();
  const candidates = ["/assets/js/dg-topbar.js"];
  if (firstSeg) candidates.push("/" + firstSeg + "/assets/js/dg-topbar.js");

  function load(i) {
    if (i >= candidates.length) return;
    const s = document.createElement("script");
    s.src = candidates[i];
    s.defer = true;
    s.onerror = () => load(i + 1);
    document.head.appendChild(s);
  }

  load(0);
})();
</script>
</head>
<body>
  <header class="dg-header" id="normalHeader">
    <div class="dg-container dg-header__inner">
      <a class="dg-brand" href="./">
        <span class="dg-brand__title">PDF参照モード</span>
      </a>
      <nav class="dg-nav">
        <a href="../">アプリ一覧</a>
      </nav>
    </div>
  </header>

  <!-- テストモード用ヘッダー -->
  <header class="dg-header" id="testHeader" style="display:none; background:#2c3e50">
    <div class="dg-container dg-header__inner" style="display:flex; justify-content:space-between; align-items:center">
      <div style="display:flex; align-items:center; gap:16px">
        <div class="dg-brand">
          <span class="dg-brand__title" style="color:white">テスト実施中</span>
        </div>
        <div style="color:#ffc107; font-size:14px; font-weight:bold">
          ⚠️ 他タブを開くと記録されます
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:16px">
        <span id="tabSwitchCounter" style="color:#ffc107; font-size:14px; font-weight:bold">切替: 0回</span>
        <span class="dg-brand__badge" style="background:#3498db; color:white; font-size:16px; padding:6px 12px" id="testTimer">00:00</span>
        <button id="cancelTest" class="dg-btn dg-btn--subtle" style="background:#95a5a6; border-color:#95a5a6; color:white">中止</button>
        <button id="submitTestHeader" class="dg-btn" style="background:#27ae60; border-color:#27ae60; color:white">採点して終了</button>
      </div>
    </div>
  </header>

  <main class="dg-main" id="normalMain">
    <div class="dg-container">
      <h1 class="dg-page-title">PDF参照モード</h1>
      <p class="dg-lead">PDFを表示しながら、回答UIで解きます（問題文の転載はしません）。</p>

      <div class="dg-stack">
        <section class="dg-card">
          <div class="dg-card__body">
            <h2 class="dg-page-title" style="font-size:var(--dg-text-xl); margin-top:0">PDF一覧</h2>
            <div id="pdfList"></div>
          </div>
        </section>

        <section class="dg-card" id="answerSection">
          <div class="dg-card__body">
            <h2 class="dg-page-title" style="font-size:var(--dg-text-xl); margin-top:0">回答</h2>
            <div class="dg-row" style="margin-bottom:12px; flex-wrap:wrap; gap:12px">
              <span id="currentPdf" class="dg-badge">未選択</span>
              <select id="scope" class="dg-select" style="max-width:220px"></select>
              <button id="openPdf" class="dg-btn" type="button" disabled>問題PDFを開く</button>
              <button id="openAnswerPdf" class="dg-btn dg-btn--subtle" type="button" disabled>解答PDFを開く</button>
              <button id="startTest" class="dg-btn" type="button" disabled style="background:#e74c3c; border-color:#e74c3c">テストモード開始</button>
              <div style="flex-grow:1"></div>
              <button id="grading" class="dg-btn dg-btn--primary" type="button" disabled>採点する</button>
              <button id="export" class="dg-btn" type="button" disabled>回答CSVを出力</button>
              <span id="exportStatus" class="dg-badge">-</span>
            </div>
            <div id="gradingResult" style="margin-bottom:12px"></div>
            <div id="testModeWarning" style="display:none; background:#fff3cd; border:2px solid #ffc107; padding:16px; border-radius:8px; margin-bottom:12px; text-align:center; font-weight:bold; color:#856404">
              ⚠️ テスト実施中 - 他のタブやブラウザを開くと記録されます
            </div>
            <div id="scopeNote" class="dg-help" style="margin-bottom:12px"></div>
            <div id="pdfQuestions"></div>
          </div>
        </section>
      </div>

    </div>
  </main>

  <!-- テストモード用レイアウト -->
  <div id="testModeContainer" style="display:none">
    <!-- 2カラムレイアウト -->
    <div id="testMainGrid" class="dg-test-grid">
      <!-- 左側: PDF表示 -->
      <div class="dg-test-pdf" id="testPdfPane">
        <div class="dg-test-pdf__notice" id="testPdfNotice" hidden>
          <div class="dg-stack" style="max-width:360px; text-align:center">
            <div class="dg-page-title" style="font-size:var(--dg-text-lg); margin:0">IPAのPDFは埋め込み不可</div>
            <div class="dg-help">別タブでPDFを開いて解答を続けてください。</div>
            <button id="openTestPdfNewTab" class="dg-btn" type="button">別タブで開く</button>
          </div>
        </div>
        <iframe id="testPdfViewer" style="width:100%; height:100%; border:none"></iframe>
      </div>

      <!-- 右側: 問題と選択肢 -->
      <div id="testQuestionsContainer" class="dg-test-questions">
        <div id="testQuestions"></div>
      </div>
    </div>
  </div>

  <main class="dg-main" id="normalMain" style="display:block">

  <footer class="dg-footer">
    <div class="dg-container dg-footer__inner">
      <div class="dg-footer__meta">PDF参照モード</div>
      <div class="dg-footer__meta">最終更新: 2026-01-30</div>
    </div>
  </footer>

  <script type="module" src="./app.js"></script>
</body>
</html>
