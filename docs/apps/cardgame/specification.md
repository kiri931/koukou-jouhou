# カードゲーム仕様書（静的HTML/CSS/JS・2人ローカル対戦）

## 0. 目的

ブラウザで動く静的ページ（HTML/CSS/JSのみ）で、2人が同一端末で交互に操作するターン制カードバトルを実装する。

## 1. ゲーム概要

- プレイヤー：2人（P1 / P2）
- 勝利条件：相手キャラクターを倒して得るポイントを先に3点獲得した方が勝利
- デッキ：各20枚
- 初期手札：6枚
- ドロー：毎ターン開始時に必ず1枚（先攻もドロー可能）

### 場（フィールド）

- キャラクターゾーン：各プレイヤー最大3体
- スタジアム：場に各1枚（後から出たカードで貼り替え）
- 装備：キャラに紐づく（キャラ1体に複数可を既定）

## 2. ターン構造

1. ドロー
   - ターンプレイヤーはデッキから1枚引く
2. 召喚・行動フェーズ
   - そのターンに出せるキャラクターは1体まで
   - マジック（単発）使用、装備の装着、スタジアム設置が可能
3. アタックフェーズ
   - 攻撃できる対象は相手キャラクターのみ
   - 攻撃/反撃はパワーを消費して行う（後述）
4. 相手のターンへ（ターン交代）

## 3. リソース

### 3.1 マナ（Magic用）

- マジック（単発）や装備の使用に必要
- 既定：毎ターン開始時に+1（上限10、持ち越し可）
- ※上限・増加量は後でJSONで調整可能にする

### 3.2 パワー（攻撃・反撃・必殺用）

- 毎ターン開始時に+1し、**スタック（持ち越し）**する
- 攻撃・反撃・必殺技の発動で消費
- 既定：上限なし（必要なら上限追加可能）

## 4. カード種類と効果範囲

### 4.1 キャラクター

- 主要要素：HP / ATK / 必殺技（キャラごとに異なる）
- 場の上限：3体
- 召喚制限：1ターン1体まで
- 攻撃対象：相手キャラクターのみ

### 4.2 マジック（単発）

- 使用時に効果を発動し、その後捨て札へ
- マナを消費する

### 4.3 装備（継続）

- キャラクターに装着し、継続効果を与える
- マナを消費する
- 装着先キャラが場を離れた場合：既定で装備はすべて捨て札へ（墓地落ち）

### 4.4 スタジアム

- 各プレイヤーの場に1枚だけ存在
- 後から出したスタジアムで貼り替え（古い方は捨て札）
- 効果は永続（場にある限り適用）

## 5. バトル（攻撃・反撃）仕様

### 5.1 攻撃宣言

- ターンプレイヤーは自分のキャラ1体を選び、相手キャラ1体を対象にする
- 攻撃を行うには攻撃側がパワーを消費する
- 攻撃コスト（既定）
  - 通常攻撃：パワー1
  - 必殺技：キャラ固有（例：2～4など、JSONで定義）

### 5.2 反撃

- 防御側（攻撃された側）は反撃するか選べる
- 反撃には防御側もパワーを消費する（あなた指定）
- 反撃しない場合、防御側はダメージだけ受ける
- 反撃コスト（既定）
  - 反撃：パワー1
  - 反撃で必殺技を使えるか：既定「可能」（キャラ固有コストを払えばOK）

### 5.3 ダメージ解決（同時攻撃・同時破壊あり）

- 攻撃側が攻撃（または必殺）を行い、防御側が反撃する場合：
  - 双方のダメージを同時に適用
  - 同時にHPが0以下になった場合、同時破壊として両方が場から墓地へ
- ダメージ量
  - 通常：相手に 自分のATK
  - 必殺：キャラ固有（例：ATK×2、固定ダメージなど）

## 6. 撃破とポイント

- 相手キャラクターを1体倒す（場から墓地へ送る）たびに、倒した側が+1ポイント
- 同時破壊で両方が倒れた場合：
  - 既定：両プレイヤーに+1ポイント（同時に撃破が成立）
- 3ポイント先取で勝利
- 既定：同時に3点到達した場合は「引き分け」または「先に到達した扱い」のルールが必要
  - 既定案：同時到達は引き分け

## 7. 山札・手札・墓地

- 山札：0枚になったら？
  - 既定：ドローできないだけ（敗北条件にはしない）
- 手札上限：既定なし（必要なら上限追加可能）
- 墓地：使用済みカード置き場

## 8. 初期化・進行フロー

- カードプールJSONから各プレイヤーのデッキを生成（シャッフル）
- 初手6枚を引く
- 先攻/後攻を決定（既定：P1先攻）
- ターン進行（先攻も毎ターン1枚ドロー）

## 9. UI/操作仕様（静的2人プレイ）

- 画面は常に「現在のターンプレイヤーの操作画面」を中心に表示
- 相手の手札は非表示（枚数のみ表示）
- ターン交代時に「交代スクリーン」を挟む（覗き見防止）
- 「次のプレイヤーが操作してください」→ ボタン押下で切替

## 10. データ設計（JSON）

### 10.1 カードプール（cards.json）

あなたが決める前提で、形式のみ仕様化する（拡張しやすい）。

例フォーマット（仕様）:

```json
{
  "version": 1,
  "cards": [
    {
      "id": 101,
      "type": "character",
      "name": "ブレードナイト",
      "costMana": 0,
      "hp": 8,
      "atk": 3,
      "special": {
        "name": "斬鉄",
        "costPower": 3,
        "mode": "multiplier",
        "value": 2
      },
      "tags": ["warrior"]
    },
    {
      "id": 201,
      "type": "magic",
      "name": "火球",
      "costMana": 2,
      "effect": { "kind": "damage", "value": 4 }
    },
    {
      "id": 301,
      "type": "equipment",
      "name": "鋼の剣",
      "costMana": 1,
      "effect": { "kind": "buffAtk", "value": 1 }
    },
    {
      "id": 401,
      "type": "stadium",
      "name": "闘技場",
      "costMana": 2,
      "effect": { "kind": "powerPerTurn", "value": 1 }
    }
  ]
}
```

### 10.2 デッキ定義

- 既定：カードIDの配列（重複は同じIDを複数回）

```json
{ "deck": [101, 101, 102, 201, 301] }
```

- 実装は「cards.json + deck_p1.json + deck_p2.json」でも、「ゲーム開始時にランダム構築」でも可能
- 既定：固定デッキ（編集しやすい）

## 11. 既定のカードプール方針（あなたが決める部分の決定）

- 20枚デッキで回るように、カードプールは小さくても成立するよう設計
- 既定プール（例の方針）
  - キャラクター：12種（HP/ATK/必殺の差別化）
  - マジック：8種（単体ダメ、回復、除去、バフ/デバフなど）
  - 装備：6種（ATK+、HP+、必殺コスト軽減など）
  - スタジアム：4種（マナ/パワー補助、召喚補助など）
  - 合計：30枚前後（各デッキ20枚を組める）

## 12. 実装上のルール（判定の優先順位）

同時処理が出るため、解決順を固定する。

1. コスト支払い（マナ/パワー）
2. 攻撃宣言 → 反撃宣言
3. ダメージ同時適用
4. 破壊判定（HP<=0は墓地へ）
5. ポイント加算（撃破が成立した側へ）
6. 勝利判定（3点到達、同時は引き分け）

## 13. テスト観点（最低限）

- 先攻もドローできる
- 1ターン1体制限が効く
- キャラ上限3体が効く
- 攻撃にパワーが必要
- 反撃にパワーが必要（不足時は反撃不可）
- 同時ダメージで同時破壊が起きる
- スタジアム貼り替えができる
- 装備がキャラ破壊で墓地に行く
- 3ポイント先取、同時到達で引き分け


補足（実装のための意味づけ）

special.effect.kind

damageMultiplier: 通常ATKダメージ×value（反撃も同様に倍率適用してOK）

bonusDamage: 通常ATKに加算

pierce: “追加”固定ダメージ（実装簡単）

gainShield: シールド値を付与（次の被ダメから先に減る）

stun: 次の自分のアタックフェーズで攻撃不可

evadeNextHit: 次に受けるダメージを0にする

assassinateIfWounded: 対象HPがthreshold以下なら即破壊、そうでなければ通常攻撃扱い、などで処理

equipment.effect は「装備中ずっと適用」として扱う